{"ast":null,"code":"import _regeneratorRuntime from\"/Users/abdurrahman/VsCode/WebDev/PGHERO/MileStone12/ark-deals-client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/abdurrahman/VsCode/WebDev/PGHERO/MileStone12/ark-deals-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/abdurrahman/VsCode/WebDev/PGHERO/MileStone12/ark-deals-client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{CardElement,useElements,useStripe}from\"@stripe/react-stripe-js\";import React,{useEffect,useState}from\"react\";import{json,useNavigate}from\"react-router-dom\";import{toast}from\"react-toastify\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CheckoutForm=function CheckoutForm(_ref){var order=_ref.order;var product=order.product,_id=order._id,pId=order.pId,buyerName=order.buyerName,buyerEmail=order.buyerEmail;var resalePrice=product.resalePrice;var stripe=useStripe();var elements=useElements();var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),cardError=_useState2[0],setCardError=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),success=_useState4[0],setSuccess=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),transactionId=_useState6[0],setTransactionId=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),clientSecret=_useState8[0],setClientSecret=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),processing=_useState10[0],setProcessing=_useState10[1];var navigate=useNavigate();useEffect(function(){// Create PaymentIntent as soon as the page loads\nfetch(\"https://ark-deals-server.vercel.app/create-payment-intent\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",authorization:\"bearer \".concat(localStorage.getItem(\"arkDeals\"))},body:JSON.stringify({resalePrice:resalePrice})}).then(function(res){return res.json();}).then(function(data){return setClientSecret(data.clientSecret);});},[resalePrice]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var card,_yield$stripe$createP,error,paymentMethod,_yield$stripe$confirm,paymentIntent,confirmError,tranID;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:card=elements.getElement(CardElement);if(!(card===null)){_context.next=6;break;}return _context.abrupt(\"return\");case 6:_context.next=8;return stripe.createPaymentMethod({type:\"card\",card:card});case 8:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;if(error){setCardError(error.message);}else{setCardError(\"\");}setSuccess(\"\");setProcessing(true);_context.next=16;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:card,billing_details:{name:buyerName,email:buyerEmail}}});case 16:_yield$stripe$confirm=_context.sent;paymentIntent=_yield$stripe$confirm.paymentIntent;confirmError=_yield$stripe$confirm.error;if(!confirmError){_context.next=22;break;}setCardError(confirmError.message);return _context.abrupt(\"return\");case 22:if(paymentIntent.status===\"succeeded\"){setSuccess(\"Congrats\");setTransactionId(paymentIntent.id);tranID={tID:paymentIntent===null||paymentIntent===void 0?void 0:paymentIntent.id};fetch(\"https://ark-deals-server.vercel.app/orders-paid/\".concat(order._id),{method:\"PATCH\",headers:{\"content-type\":\"application/json\"},body:JSON.stringify(tranID)}).then(function(res){return res.json();}).then(function(data){console.log(\"order status\",data);fetch(\"https://ark-deals-server.vercel.app/orders-paid-dup/\".concat(order===null||order===void 0?void 0:order.pId),{method:\"DELETE\"}).then(function(res){return res.json();}).then(function(data){console.log(data);fetch(\"https://ark-deals-server.vercel.app/products-paid/\".concat(order.pId),{method:\"PATCH\"}).then(function(res){return res.json();}).then(function(data){console.log(\"product status\",data);if(data.modifiedCount>=1){fetch(\"https://ark-deals-server.vercel.app/delete-advertisement/\".concat(order.pId),{method:\"DELETE\"}).then(function(res){return res.json();}).then(function(data){console.log(\"delete\",data);if(data.acknowledged){toast.success(\"Payment Succesfull!\");navigate(\"/dashboard/myorders\");}});}});});});}setProcessing(false);console.log(\"payment intent\",paymentIntent);case 25:case\"end\":return _context.stop();}},_callee);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{className:\"w-1/2 border\",options:{style:{base:{fontSize:\"16px\",color:\"#424770\",\"::placeholder\":{color:\"#aab7c4\"}},invalid:{color:\"#9e2146\"}}}}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-sm w-1/2\",disabled:!stripe||!clientSecret||processing,children:\"Pay\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500\",children:cardError}),success&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-green-500\",children:success}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Your transactionId:\",\" \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold\",children:transactionId}),\" \"]})]})]});};export default CheckoutForm;","map":{"version":3,"names":["CardElement","useElements","useStripe","React","useEffect","useState","json","useNavigate","toast","CheckoutForm","order","product","_id","pId","buyerName","buyerEmail","resalePrice","stripe","elements","cardError","setCardError","success","setSuccess","transactionId","setTransactionId","clientSecret","setClientSecret","processing","setProcessing","navigate","fetch","method","headers","authorization","localStorage","getItem","body","JSON","stringify","then","res","data","handleSubmit","e","preventDefault","card","getElement","createPaymentMethod","type","error","paymentMethod","message","confirmCardPayment","payment_method","billing_details","name","email","paymentIntent","confirmError","status","id","tranID","tID","console","log","modifiedCount","acknowledged","style","base","fontSize","color","invalid"],"sources":["/Users/abdurrahman/VsCode/WebDev/PGHERO/MileStone12/ark-deals-client/src/Pages/Dashboard/Buyer/Payment/CheckoutForm.jsx"],"sourcesContent":["import { CardElement, useElements, useStripe } from \"@stripe/react-stripe-js\";\nimport React, { useEffect, useState } from \"react\";\nimport { json, useNavigate } from \"react-router-dom\";\nimport { toast } from \"react-toastify\";\n\nconst CheckoutForm = ({ order }) => {\n  const { product, _id, pId, buyerName, buyerEmail } = order;\n  const { resalePrice } = product;\n  const stripe = useStripe();\n  const elements = useElements();\n  const [cardError, setCardError] = useState(\"\");\n  const [success, setSuccess] = useState(\"\");\n  const [transactionId, setTransactionId] = useState(\"\");\n  const [clientSecret, setClientSecret] = useState(\"\");\n  const [processing, setProcessing] = useState(false);\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    // Create PaymentIntent as soon as the page loads\n    fetch(`https://ark-deals-server.vercel.app/create-payment-intent`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        authorization: `bearer ${localStorage.getItem(\"arkDeals\")}`,\n      },\n      body: JSON.stringify({ resalePrice }),\n    })\n      .then((res) => res.json())\n      .then((data) => setClientSecret(data.clientSecret));\n  }, [resalePrice]);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!stripe || !elements) {\n      return;\n    }\n\n    const card = elements.getElement(CardElement);\n\n    if (card === null) {\n      return;\n    }\n\n    const { error, paymentMethod } = await stripe.createPaymentMethod({\n      type: \"card\",\n      card,\n    });\n\n    if (error) {\n      setCardError(error.message);\n    } else {\n      setCardError(\"\");\n    }\n    setSuccess(\"\");\n    setProcessing(true);\n    const { paymentIntent, error: confirmError } =\n      await stripe.confirmCardPayment(clientSecret, {\n        payment_method: {\n          card: card,\n          billing_details: {\n            name: buyerName,\n            email: buyerEmail,\n          },\n        },\n      });\n    if (confirmError) {\n      setCardError(confirmError.message);\n      return;\n    }\n    if (paymentIntent.status === \"succeeded\") {\n      setSuccess(\"Congrats\");\n      setTransactionId(paymentIntent.id);\n      const tranID = {\n        tID: paymentIntent?.id,\n      };\n\n      fetch(`https://ark-deals-server.vercel.app/orders-paid/${order._id}`, {\n        method: \"PATCH\",\n        headers: {\n          \"content-type\": \"application/json\",\n        },\n        body: JSON.stringify(tranID),\n      })\n        .then((res) => res.json())\n        .then((data) => {\n          console.log(\"order status\", data);\n          fetch(\n            `https://ark-deals-server.vercel.app/orders-paid-dup/${order?.pId}`,\n            {\n              method: \"DELETE\",\n            }\n          )\n            .then((res) => res.json())\n            .then((data) => {\n              console.log(data);\n\n              fetch(\n                `https://ark-deals-server.vercel.app/products-paid/${order.pId}`,\n                {\n                  method: \"PATCH\",\n                }\n              )\n                .then((res) => res.json())\n                .then((data) => {\n                  console.log(\"product status\", data);\n                  if (data.modifiedCount >= 1) {\n                    fetch(\n                      `https://ark-deals-server.vercel.app/delete-advertisement/${order.pId}`,\n                      {\n                        method: \"DELETE\",\n                      }\n                    )\n                      .then((res) => res.json())\n                      .then((data) => {\n                        console.log(\"delete\", data);\n                        if (data.acknowledged) {\n                          toast.success(\"Payment Succesfull!\");\n                          navigate(\"/dashboard/myorders\");\n                        }\n                      });\n                  }\n                });\n            });\n        });\n    }\n    setProcessing(false);\n    console.log(\"payment intent\", paymentIntent);\n  };\n  return (\n    <>\n      <form onSubmit={handleSubmit}>\n        <CardElement\n          className=\"w-1/2 border\"\n          options={{\n            style: {\n              base: {\n                fontSize: \"16px\",\n                color: \"#424770\",\n                \"::placeholder\": {\n                  color: \"#aab7c4\",\n                },\n              },\n              invalid: {\n                color: \"#9e2146\",\n              },\n            },\n          }}\n        />\n        <button\n          type=\"submit\"\n          className=\"btn btn-sm w-1/2\"\n          disabled={!stripe || !clientSecret || processing}\n        >\n          Pay\n        </button>\n      </form>\n      <p className=\"text-red-500\">{cardError}</p>\n      {success && (\n        <div>\n          <p className=\"text-green-500\">{success}</p>\n          <p>\n            Your transactionId:{\" \"}\n            <span className=\"font-bold\">{transactionId}</span>{\" \"}\n          </p>\n        </div>\n      )}\n    </>\n  );\n};\n\nexport default CheckoutForm;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}