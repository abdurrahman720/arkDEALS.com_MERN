{"ast":null,"code":"import _regeneratorRuntime from\"/Users/abdurrahman/VsCode/WebDev/PGHERO/MileStone12/ark-deals-client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/abdurrahman/VsCode/WebDev/PGHERO/MileStone12/ark-deals-client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/abdurrahman/VsCode/WebDev/PGHERO/MileStone12/ark-deals-client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{CardElement,useElements,useStripe}from'@stripe/react-stripe-js';import React,{useEffect,useState}from'react';import{json,useNavigate}from'react-router-dom';import{toast}from'react-toastify';import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CheckoutForm=function CheckoutForm(_ref){var order=_ref.order;var product=order.product,_id=order._id,pId=order.pId,buyerName=order.buyerName,buyerEmail=order.buyerEmail;var resalePrice=product.resalePrice;var stripe=useStripe();var elements=useElements();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),cardError=_useState2[0],setCardError=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),success=_useState4[0],setSuccess=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),transactionId=_useState6[0],setTransactionId=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),clientSecret=_useState8[0],setClientSecret=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),processing=_useState10[0],setProcessing=_useState10[1];var navigate=useNavigate();useEffect(function(){// Create PaymentIntent as soon as the page loads\nfetch(\"http://localhost:5001/create-payment-intent\",{method:\"POST\",headers:{\"Content-Type\":\"application/json\",authorization:\"bearer \".concat(localStorage.getItem('arkDeals'))},body:JSON.stringify({resalePrice:resalePrice})}).then(function(res){return res.json();}).then(function(data){return setClientSecret(data.clientSecret);});},[resalePrice]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var card,_yield$stripe$createP,error,paymentMethod,_yield$stripe$confirm,paymentIntent,confirmError,tranID;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:card=elements.getElement(CardElement);if(!(card===null)){_context.next=6;break;}return _context.abrupt(\"return\");case 6:_context.next=8;return stripe.createPaymentMethod({type:'card',card:card});case 8:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;if(error){setCardError(error.message);}else{setCardError('');}setSuccess('');setProcessing(true);_context.next=16;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:card,billing_details:{name:buyerName,email:buyerEmail}}});case 16:_yield$stripe$confirm=_context.sent;paymentIntent=_yield$stripe$confirm.paymentIntent;confirmError=_yield$stripe$confirm.error;if(!confirmError){_context.next=22;break;}setCardError(confirmError.message);return _context.abrupt(\"return\");case 22:if(paymentIntent.status===\"succeeded\"){setSuccess(\"Congrats\");setTransactionId(paymentIntent.id);tranID={tID:transactionId};fetch(\"http://localhost:5001/orders-paid/\".concat(order._id),{method:'PATCH',headers:{'content-type':'application/json'},body:JSON.stringify(tranID)}).then(function(res){return res.json();}).then(function(data){console.log(\"order status\",data);fetch(\"http://localhost:5001/orders-paid-dup/\".concat(order===null||order===void 0?void 0:order.pId),{method:'DELETE'}).then(function(res){return res.json();}).then(function(data){console.log(data);if(data.deletedCount>=1){fetch(\"http://localhost:5001/products-paid/\".concat(order.pId),{method:'PATCH'}).then(function(res){return res.json();}).then(function(data){console.log(\"product status\",data);if(data.modifiedCount>=1){fetch(\"http://localhost:5001/delete-advertisement/\".concat(order.pId),{method:'DELETE'}).then(function(res){return res.json();}).then(function(data){console.log(\"delete\",data);if(data.acknowledged){toast.success(\"Payment Succesfull!\");navigate('/dashboard/myorders');}});}});}else{toast.success(\"Payment Succesfull!\");navigate('/dashboard/myorders');}});});}setProcessing(false);console.log(\"payment intent\",paymentIntent);case 25:case\"end\":return _context.stop();}},_callee);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{className:\"w-1/2 border\",options:{style:{base:{fontSize:'16px',color:'#424770','::placeholder':{color:'#aab7c4'}},invalid:{color:'#9e2146'}}}}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",className:\"btn btn-sm w-1/2\",disabled:!stripe||!clientSecret||processing,children:\"Pay\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-500\",children:cardError}),success&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-green-500\",children:success}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Your transactionId: \",/*#__PURE__*/_jsx(\"span\",{className:\"font-bold\",children:transactionId}),\" \"]})]})]});};export default CheckoutForm;","map":{"version":3,"names":["CardElement","useElements","useStripe","React","useEffect","useState","json","useNavigate","toast","CheckoutForm","order","product","_id","pId","buyerName","buyerEmail","resalePrice","stripe","elements","cardError","setCardError","success","setSuccess","transactionId","setTransactionId","clientSecret","setClientSecret","processing","setProcessing","navigate","fetch","method","headers","authorization","localStorage","getItem","body","JSON","stringify","then","res","data","handleSubmit","e","preventDefault","card","getElement","createPaymentMethod","type","error","paymentMethod","message","confirmCardPayment","payment_method","billing_details","name","email","paymentIntent","confirmError","status","id","tranID","tID","console","log","deletedCount","modifiedCount","acknowledged","style","base","fontSize","color","invalid"],"sources":["/Users/abdurrahman/VsCode/WebDev/PGHERO/MileStone12/ark-deals-client/src/Pages/Dashboard/Buyer/Payment/CheckoutForm.jsx"],"sourcesContent":["import { CardElement, useElements, useStripe } from '@stripe/react-stripe-js';\nimport React, { useEffect, useState } from 'react';\nimport { json, useNavigate } from 'react-router-dom';\nimport { toast } from 'react-toastify';\n\nconst CheckoutForm = ({ order }) => {\n    const { product, _id, pId, buyerName,buyerEmail } = order;\n    const {resalePrice} = product;\n    const stripe = useStripe()\n    const elements = useElements();\n    const [cardError, setCardError] = useState('');\n    const [success, setSuccess] = useState('');\n    const [transactionId, setTransactionId] = useState('');\n    const [clientSecret, setClientSecret] = useState(\"\");\n    const [processing, setProcessing] = useState(false)\n    const navigate = useNavigate()\n\n    useEffect(() => {\n        // Create PaymentIntent as soon as the page loads\n        fetch(`http://localhost:5001/create-payment-intent`, {\n          method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                authorization: `bearer ${localStorage.getItem('arkDeals')}`\n            },\n          body: JSON.stringify({ resalePrice }),\n        })\n          .then((res) => res.json())\n          .then((data) => setClientSecret(data.clientSecret));\n      }, [resalePrice]);\n    \n\n\n    const handleSubmit = async (e) => {\n        e.preventDefault();\n        if (!stripe || !elements) {\n            return;\n        }\n\n        const card = elements.getElement(CardElement);\n\n        if (card === null) {\n            return;\n        }\n\n        const {error,paymentMethod } = await stripe.createPaymentMethod({\n            type: 'card',\n            card\n        })\n\n        if (error) {\n            setCardError(error.message)\n\n        }\n        else {\n            setCardError('')\n        }\n        setSuccess('')\n        setProcessing(true)\n        const {paymentIntent, error: confirmError} = await stripe.confirmCardPayment(\n            clientSecret,\n            {\n              payment_method: {\n                card: card,\n                billing_details: {\n                    name:  buyerName ,\n                    email: buyerEmail\n                },\n              },\n            },\n        );\n        if (confirmError) {\n            setCardError(confirmError.message)\n            return;\n        }\n        if (paymentIntent.status === \"succeeded\") {\n            setSuccess(\"Congrats\")\n            setTransactionId(paymentIntent.id)\n            const tranID = {\n                tID: transactionId\n            }\n\n            fetch(`http://localhost:5001/orders-paid/${order._id}`, {\n                method: 'PATCH',\n                headers: {\n                    'content-type': 'application/json'\n                },\n                body: JSON.stringify(tranID)\n    })\n      .then(res => res.json())\n      .then(data => {\n        console.log(\"order status\",data)\n        fetch(`http://localhost:5001/orders-paid-dup/${order?.pId}`, {\n          method: 'DELETE'\n        })\n          .then(res => res.json())\n          .then(data => {\n            console.log(data)\n            if (data.deletedCount >= 1) {\n              fetch(`http://localhost:5001/products-paid/${order.pId}`, {\n                method: 'PATCH'\n                })\n                  .then(res => res.json())\n                  .then(data => {\n                    console.log(\"product status\",data);\n                    if (data.modifiedCount>=1) {\n                      fetch(`http://localhost:5001/delete-advertisement/${order.pId}`, {\n                        method: 'DELETE',\n                       \n                      })\n                        .then(res => res.json())\n                        .then(data => {\n                          console.log(\"delete\",data)\n                          if (data.acknowledged) {\n                              toast.success(\"Payment Succesfull!\")\n                              navigate('/dashboard/myorders')\n                          }\n                      })\n                  }\n                })\n            }\n            else {\n                toast.success(\"Payment Succesfull!\")\n                navigate('/dashboard/myorders')\n              }\n        })\n\n    })\n\n            \n        }\n        setProcessing(false)\n        console.log(\"payment intent\",paymentIntent);\n\n    }\n    return (\n        <>\n        <form onSubmit={handleSubmit}>\n            <CardElement\n                className='w-1/2 border'\n        options={{\n          style: {\n            base: {\n              fontSize: '16px',\n              color: '#424770',\n              '::placeholder': {\n                color: '#aab7c4',\n              },\n            },\n            invalid: {\n              color: '#9e2146',\n            },\n          },\n        }}\n      />\n      <button type=\"submit\" className='btn btn-sm w-1/2' disabled={!stripe || !clientSecret || processing}>\n        Pay\n      </button>\n            </form>\n            <p className=\"text-red-500\">{cardError}</p>\n            {\n                success && <div>\n                    <p className=\"text-green-500\">\n                        {success}\n                    </p>\n                    <p>Your transactionId: <span className=\"font-bold\">\n                    {transactionId}\n                    </span> </p>\n                </div>\n            }\n        </>\n    );\n};\n\nexport default CheckoutForm;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}